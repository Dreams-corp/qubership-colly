<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Qubership Colly</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/style.css">

</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

<h2>Environments</h2>
<div class="input-group mb-3" style="max-width: 300px;">
    <span class="input-group-text" id="basic-addon1">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
             fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
        </svg>
    </span>
    <input id="filterInput" type="text" class="form-control" placeholder="Search Environment.." aria-label="Username"
           aria-describedby="basic-addon1" onkeyup="filterTable()">
</div>

<table id="envTable" class="table table-hover">
    <tr>
        <th class="sortable" onclick="sortTable(0)">Env</th>
        <th class="sortable" onclick="sortTable(1)">Namespace</th>
        <th class="sortable" onclick="sortTable(2)">Cluster</th>
        <th class="sortable" onclick="sortTable(3)">Active Pods</th>
    </tr>
    {#for cluster in clusters}
        {#for namespace in cluster.namespaces}
            <tr>
                <td>{namespace.envName}</td>
                <td>{namespace.name}</td>
                <td>{cluster.name}</td>
                <td>{namespace.pods.size}</td>
            </tr>
        {/for}
    {/for}
</table>

<script>
    function sortTable(columnIndex) {
        let table = document.getElementById("envTable");
        let rows = Array.from(table.rows).slice(1);

        let sortOrder = table.dataset.sortOrder === "asc" ? "desc" : "asc";

        let sortedRows = rows.sort((a, b) => {
            let cellA = a.cells[columnIndex].innerText.trim();
            let cellB = b.cells[columnIndex].innerText.trim();

            return sortOrder === "asc"
                ? cellA.localeCompare(cellB)
                : cellB.localeCompare(cellA);
        });

        let headers = table.querySelectorAll("th");
        headers.forEach((header, index) => {
            header.classList.remove("sort-asc", "sort-desc");
            if (index === columnIndex) {
                header.classList.add(sortOrder === "asc" ? "sort-asc" : "sort-desc");
            }
        });

        sortedRows.forEach(row => table.tBodies[0].appendChild(row));
        table.dataset.sortOrder = sortOrder;
        table.dataset.sortColumn = columnIndex;
    }

    function filterTable() {

        let input = document.getElementById('filterInput');
        let filter = input.value.toLowerCase();
        let table = document.getElementById('envTable');
        let rows = table.getElementsByTagName('tr');

        for (let i = 1; i < rows.length; i++) {
            let cells = rows[i].getElementsByTagName('td');
            let match = false;
            for (let j = 0; j < cells.length; j++) {
                if (cells[j].innerText.toLowerCase().includes(filter)) {
                    match = true;
                    break;
                }
            }
            rows[i].style.display = match ? "" : "none";
        }
    }
</script>
</body>
</html>